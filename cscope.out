cscope 15 $HOME/source/panda               0000016242
	@include/asm.h

9 #ià!
defšed
(
ASM_H
)

10 
	#ASM_H


	)

13 
	#ENABLE_NMI
 0x00

	)

14 
	#DISABLE_NMI
 0x80

	)

16 
šw
 (
_pÜt
);

17 
šb
 (
_pÜt
);

19 
šlše
 
outb
 (
_pÜt
, 
_d©a
);

20 
šlše
 
wr™e_nmi
(
nmi
);

21 
šlše
 
’abË_nmi
();

22 
šlše
 
di§bË_nmi
();

24 
	#loÿl_œq_di§bË
(è(
	`Çtive_œq_di§bË
())

	)

25 
	#loÿl_œq_’abË
(è(
	`Çtive_œq_’abË
())

	)

26 
	#§ã_h®t
(è(
	`Çtive_§ã_h®t
())

	)

29 
šlše
 
	$Çtive_œq_§ve
()

31 
æags
;

38 
asm
 volatile("# __raw_save_flags\n\t"

40 : "ôm" (
æags
)

44  
æags
;

45 
	}
}

47 
šlše
 
	$Çtive_œq_»¡Üe
(
æags
)

49 
asm
 volatile("push %0 ;…opf"

51 :"g" (
æags
)

53 
	}
}

55 
šlše
 
	$Çtive_œq_di§bË
()

57 
asm
 volatile("cli": : :"memory");

58 
	}
}

60 
šlše
 
	$Çtive_œq_’abË
()

62 
asm
 volatile("sti": : :"memory");

63 
	}
}

65 
šlše
 
	$Çtive_§ã_h®t
()

67 
asm
 volatile("sti; hlt": : :"memory");

68 
	}
}

70 
šlše
 
	$Çtive_h®t
()

72 
asm
 volatile("hlt": : :"memory");

73 
	}
}

80 
	#ty³check
(
ty³
,
x
) \

81 ({ 
ty³
 
__dummy
; \

82 
	`ty³of
(
x
è
__dummy2
; \

83 ()(&
__dummy
 =ğ&
__dummy2
); \

85 })

	)

88 
	#loÿl_œq_§ve
(
æags
) \

89 dØ{ 
	`ty³check
(, 
æags
); \

90 
æags
 = 
	`Çtive_œq_§ve
(); \

92 

	)

93 
	#loÿl_œq_»¡Üe
(
æags
) \

94 dØ{ 
	`ty³check
(, 
æags
); \

95 
æags
 = 
	`Çtive_œq_»¡Üe
(); \

97 

	)

	@include/kb.h

9 #ià!
defšed
(
KD_H
)

10 
	#KD_H


	)

17 
	gkbdus
[128] =

	@include/screen.h

9 #ià!
defšed
(
SCREEN_H
)

10 
	#SCREEN_H


	)

12 
	~<sy¡em.h
>

14 
š™_video
();

15 
putch
(
c
);

16 
puts
(cÚ¡ * 
‹xt
);

17 
´štk
(cÚ¡ * 
‹xt
);

18 
´štk_hex
(
u32
 
v®
);

19 
´štk_št
(
u32
 
v®
);

20 * 
mem£t
(* 
addr
, 
v
, 
size_t
 
út
);

21 * 
memıy
(*
de¡
, cÚ¡ *
¤c
, 
size_t
 
út
);

22 * 
memmove
(* 
de¡
, cÚ¡ * 
¤c
, 
size_t
 
út
);

25 
gdt_š™
();

26 
idt_š™
();

27 
kb_š™
();

	@include/system.h

9 #ià!
defšed
(
SYSTEM_H
)

10 
	#SYSTEM_H


	)

13 
	tsize_t
;

14 
	tu64
;

15 sigÃd 
	ts64
;

16 
	tu32
;

17 sigÃd 
	ts32
;

18 
	tu16
;

19 sigÃd 
	ts16
;

20 
	tu8
;

21 sigÃd 
	ts8
;

25 
	s»gi¡”s_t


27 
	mgs
, 
	mfs
, 
	mes
, 
	mds
;

28 
	medi
, 
	mesi
, 
	mebp
, 
	me¥
, 
	mebx
, 
	medx
, 
	mecx
, 
	m—x
;

29 
	mšt_no
, 
	m”r_code
;

30 
	me
, 
	mcs
, 
	meæags
, 
	mu£»¥
, 
	mss
;

33 (*
	tisq_t
è(
	t»gi¡”s_t
* 
	tr
);

35 
	`œq_š¡®l_hªdËr
(
œq
, 
isq_t
 
hªdËr
);

36 
	`idt_£t
(
k
, 
ba£
,

37 
£ËùÜ
, 
æags
);

39 
	`tim”_š™
(
u32
 
äequ’cy
);

40 
	`tim”_wa™
(
ticks
);

	@kernel/asm.c

9 
	~<asm.h
>

11 
	#š
(
pÜt
) ({ \

12 
v
; \

13 
__asm__
 
	`__vŞ©e__
 ("inb %%dx, %%al" \

14 : "÷" (
v
è: "d" (
pÜt
)); \

15 
v
; \

16 })

	)

18 
	#out
(
pÜt
, 
v®ue
) \

19 
__asm__
 
	`__vŞ©e__
 ("outb %%®, %%dx" :: "a" (
v®ue
), \

20 "d" (
pÜt
)) \

21 

	)

24 
	$šw
 (
_pÜt
)

26 
rv
;

27 
__asm__
 
	`__vŞ©e__
 ("šw %1, %0" : "÷" (
rv
è: "dN" (
_pÜt
));

28  
rv
;

29 
	}
}

31 
	$šb
 (
_pÜt
)

33 
rv
;

34 
__asm__
 
	`__vŞ©e__
 ("šb %1, %0" : "÷" (
rv
è: "dN" (
_pÜt
));

35  
rv
;

36 
	}
}

38 
	$outb
 (
_pÜt
, 
_d©a
)

40 
__asm__
 
	`__vŞ©e__
 ("outb %1, %0" : : "dN" (
_pÜt
), "a" (
_d©a
));

41 
	}
}

44 
šlše
 
	$wr™e_nmi
(
nmi
)

46 
	`out
(0x70, 
nmi
);

47 
	`š
(0x71);

48 
	}
}

50 
šlše
 
	$’abË_nmi
()

52 
	`wr™e_nmi
(
ENABLE_NMI
);

53 
	}
}

55 
šlše
 
	$di§bË_nmi
()

57 
	`wr™e_nmi
(
DISABLE_NMI
);

58 
	}
}

	@kernel/gdt.c

9 
	~<sy¡em.h
>

14 
	sgdt_’Œy


16 
	mlim™
;

17 
	mba£_low
;

18 
	mba£_middË
;

19 
	macûss
;

20 
	mg¿nuÏr™y
;

21 
	mba£_high
;

22 } 
__©Œibu‹__
((
·cked
));

24 
	sgdt_±r


26 
	mlim™
;

27 
	mba£
;

28 } 
__©Œibu‹__
((
·cked
));

30 
gdt_’Œy
 
	ggdt
[3];

31 
gdt_±r
 
	ggp
;

33 
gdt_æush
();

37 
	$gdt_£t_’Œy
(
num
, 
ba£
, 
lim™
,

38 
acûss
, 
g¿n
)

41 
gdt
[
num
].
ba£_low
 = (
ba£
 & 0xFFFF);

42 
gdt
[
num
].
ba£_middË
 = (
ba£
 >> 16) & 0xFF;

43 
gdt
[
num
].
ba£_high
 = (
ba£
 >> 24) & 0xFF;

46 
gdt
[
num
].
lim™
 = (limit & 0xFFFF);

47 
gdt
[
num
].
g¿nuÏr™y
 = ((
lim™
 >> 16) & 0x0F);

50 
gdt
[
num
].
g¿nuÏr™y
 |ğ(
g¿n
 & 0xF0);

51 
gdt
[
num
].
acûss
 =‡ccess;

52 
	}
}

54 
	$gdt_š™
()

57 
gp
.
lim™
 = ((
gdt_’Œy
) * 3) - 1;

58 
gp
.
ba£
 = ()&
gdt
;

61 
	`gdt_£t_’Œy
(0, 0, 0, 0, 0);

67 
	`gdt_£t_’Œy
(1, 0, 0xFFFFFFFF, 0x9A, 0xCF);

72 
	`gdt_£t_’Œy
(2, 0, 0xFFFFFFFF, 0x92, 0xCF);

76 
	`gdt_æush
();

77 
	}
}

	@kernel/idt.c

9 
	~<sy¡em.h
>

10 
	~<sü“n.h
>

11 
	~<asm.h
>

39 
	sidt_’Œy


41 
	mba£_lo
;

42 
	m£ËùÜ
;

43 
	mz”o
;

44 
	mæags
;

45 
	mba£_hi
;

46 } 
__©Œibu‹__
((
·cked
));

48 
	sidt_±r


50 
	mlim™
;

51 
	mba£
;

52 } 
__©Œibu‹__
((
·cked
));

55 
idt_’Œy
 
	gidt
[256];

56 
idt_±r
 
	gid
;

59 
idt_lßd
();

62 
i¤0
 ();

63 
i¤1
 ();

64 
i¤2
 ();

65 
i¤3
 ();

66 
i¤4
 ();

67 
i¤5
 ();

68 
i¤6
 ();

69 
i¤7
 ();

70 
i¤8
 ();

71 
i¤9
 ();

72 
i¤10
();

73 
i¤11
();

74 
i¤12
();

75 
i¤13
();

76 
i¤14
();

77 
i¤15
();

78 
i¤16
();

79 
i¤17
();

80 
i¤18
();

81 
i¤19
();

82 
i¤20
();

83 
i¤21
();

84 
i¤22
();

85 
i¤23
();

86 
i¤24
();

87 
i¤25
();

88 
i¤26
();

89 
i¤27
();

90 
i¤28
();

91 
i¤29
();

92 
i¤30
();

93 
i¤31
();

94 
œq0
 ();

95 
œq1
 ();

96 
œq2
 ();

97 
œq3
 ();

98 
œq4
 ();

99 
œq5
 ();

100 
œq6
 ();

101 
œq7
 ();

102 
œq8
 ();

103 
œq9
 ();

104 
œq10
();

105 
œq11
();

106 
œq12
();

107 
œq13
();

108 
œq14
();

109 
œq15
();

113 cÚ¡ * 
	gexû±iÚ_mes§ges
[32] =

153 
	$idt_£t
(
k
, 
ba£
,

154 
£ËùÜ
, 
æags
)

157 
idt
[
k
].
ba£_lo
 = (
ba£
 & 0xFFFF);

158 
idt
[
k
].
ba£_hi
 = (
ba£
 >> 16) & 0xFFFF;

162 
idt
[
k
].
£ËùÜ
 = selector;

163 
idt
[
k
].
z”o
 = 0;

164 
idt
[
k
].
æags
 = flags;

165 
	}
}

167 
isq_t
 
œq_routšes
[];

170 
	$idt_š™
()

173 
id
.
lim™
 = ( (
idt_’Œy
) * 256) - 1;

174 
id
.
ba£
 = (
u32
)&
idt
;

177 
	`mem£t
(&
idt
, 0, (
idt_’Œy
) * 256);

181 
	`outb
(0x20, 0x11);

182 
	`outb
(0xA0, 0x11);

183 
	`outb
(0x21, 0x20);

184 
	`outb
(0xA1, 0x28);

185 
	`outb
(0x21, 0x04);

186 
	`outb
(0xA1, 0x02);

187 
	`outb
(0x21, 0x01);

188 
	`outb
(0xA1, 0x01);

189 
	`outb
(0x21, 0x0);

190 
	`outb
(0xA1, 0x0);

196 
	`idt_£t
Ğ0, (
u32
)
i¤0
 , 0x08, 0x8E);

197 
	`idt_£t
Ğ1, (
u32
)
i¤1
 , 0x08, 0x8E);

198 
	`idt_£t
Ğ2, (
u32
)
i¤2
 , 0x08, 0x8E);

199 
	`idt_£t
Ğ3, (
u32
)
i¤3
 , 0x08, 0x8E);

200 
	`idt_£t
Ğ4, (
u32
)
i¤4
 , 0x08, 0x8E);

201 
	`idt_£t
Ğ5, (
u32
)
i¤5
 , 0x08, 0x8E);

202 
	`idt_£t
Ğ6, (
u32
)
i¤6
 , 0x08, 0x8E);

203 
	`idt_£t
Ğ7, (
u32
)
i¤7
 , 0x08, 0x8E);

204 
	`idt_£t
Ğ8, (
u32
)
i¤8
 , 0x08, 0x8E);

205 
	`idt_£t
Ğ9, (
u32
)
i¤9
 , 0x08, 0x8E);

206 
	`idt_£t
(10, (
u32
)
i¤10
, 0x08, 0x8E);

207 
	`idt_£t
(11, (
u32
)
i¤11
, 0x08, 0x8E);

208 
	`idt_£t
(12, (
u32
)
i¤12
, 0x08, 0x8E);

209 
	`idt_£t
(13, (
u32
)
i¤13
, 0x08, 0x8E);

210 
	`idt_£t
(14, (
u32
)
i¤14
, 0x08, 0x8E);

211 
	`idt_£t
(15, (
u32
)
i¤15
, 0x08, 0x8E);

212 
	`idt_£t
(16, (
u32
)
i¤16
, 0x08, 0x8E);

213 
	`idt_£t
(17, (
u32
)
i¤17
, 0x08, 0x8E);

214 
	`idt_£t
(18, (
u32
)
i¤18
, 0x08, 0x8E);

215 
	`idt_£t
(19, (
u32
)
i¤19
, 0x08, 0x8E);

216 
	`idt_£t
(20, (
u32
)
i¤20
, 0x08, 0x8E);

217 
	`idt_£t
(21, (
u32
)
i¤21
, 0x08, 0x8E);

218 
	`idt_£t
(22, (
u32
)
i¤22
, 0x08, 0x8E);

219 
	`idt_£t
(23, (
u32
)
i¤23
, 0x08, 0x8E);

220 
	`idt_£t
(24, (
u32
)
i¤24
, 0x08, 0x8E);

221 
	`idt_£t
(25, (
u32
)
i¤25
, 0x08, 0x8E);

222 
	`idt_£t
(26, (
u32
)
i¤26
, 0x08, 0x8E);

223 
	`idt_£t
(27, (
u32
)
i¤27
, 0x08, 0x8E);

224 
	`idt_£t
(28, (
u32
)
i¤28
, 0x08, 0x8E);

225 
	`idt_£t
(29, (
u32
)
i¤29
, 0x08, 0x8E);

226 
	`idt_£t
(30, (
u32
)
i¤30
, 0x08, 0x8E);

227 
	`idt_£t
(31, (
u32
)
i¤31
, 0x08, 0x8E);

229 
	`idt_£t
(32, (
u32
)
œq0
, 0x08, 0x8E);

230 
	`idt_£t
(33, (
u32
)
œq1
, 0x08, 0x8E);

231 
	`idt_£t
(34, (
u32
)
œq2
, 0x08, 0x8E);

232 
	`idt_£t
(35, (
u32
)
œq3
, 0x08, 0x8E);

233 
	`idt_£t
(36, (
u32
)
œq4
, 0x08, 0x8E);

234 
	`idt_£t
(37, (
u32
)
œq5
, 0x08, 0x8E);

235 
	`idt_£t
(38, (
u32
)
œq6
, 0x08, 0x8E);

236 
	`idt_£t
(39, (
u32
)
œq7
, 0x08, 0x8E);

238 
	`idt_£t
(40, (
u32
)
œq8
, 0x08, 0x8E);

239 
	`idt_£t
(41, (
u32
)
œq9
, 0x08, 0x8E);

240 
	`idt_£t
(42, (
u32
)
œq10
, 0x08, 0x8E);

241 
	`idt_£t
(43, (
u32
)
œq11
, 0x08, 0x8E);

242 
	`idt_£t
(44, (
u32
)
œq12
, 0x08, 0x8E);

243 
	`idt_£t
(45, (
u32
)
œq13
, 0x08, 0x8E);

244 
	`idt_£t
(46, (
u32
)
œq14
, 0x08, 0x8E);

245 
	`idt_£t
(47, (
u32
)
œq15
, 0x08, 0x8E);

248 
asm
 volatile(

250 :: "m"(
id
));

252 
	`mem£t
(&
œq_routšes
 , 0, (
isq_t
)*256);

253 
	}
}

256 
	$i¤_hªdËr
(
»gi¡”s_t
* 
»gs
)

258 
	`puts
("recieved interrupt: ");

259 
	`´štk_hex
(
»gs
->
št_no
);

260 
	`puts
("\n");

263 ià(
»gs
->
št_no
 < 32)

265 
	`puts
(
exû±iÚ_mes§ges
[
»gs
->
št_no
]);

266 
	`puts
("\n");

269 
	}
}

	@kernel/irq.c

10 
	~<sy¡em.h
>

11 
	~<asm.h
>

12 
	~<sü“n.h
>

14 
œq0
();

15 
œq1
();

16 
œq2
();

17 
œq3
();

18 
œq4
();

19 
œq5
();

20 
œq6
();

21 
œq7
();

22 
œq8
();

23 
œq9
();

24 
œq10
();

25 
œq11
();

26 
œq12
();

27 
œq13
();

28 
œq14
();

29 
œq15
();

34 
isq_t
 
	gœq_routšes
[256];

37 
	$œq_š¡®l_hªdËr
(
œq
, 
isq_t
 
hªdËr
)

39 
	`´štk
("now irq_install_handler\n");

40 
œq_routšes
[
œq
] = 
hªdËr
;

41 
	}
}

44 
	$œq_unš¡®l_hªdËr
(
œq
)

46 
œq_routšes
[
œq
] = 0;

47 
	}
}

57 
	$œq_»m­
()

59 
	`outb
(0x20, 0x11);

60 
	`outb
(0xA0, 0x11);

61 
	`outb
(0x21, 0x20);

62 
	`outb
(0xA1, 0x28);

63 
	`outb
(0x21, 0x04);

64 
	`outb
(0xA1, 0x02);

65 
	`outb
(0x21, 0x01);

66 
	`outb
(0xA1, 0x01);

67 
	`outb
(0x21, 0x0);

68 
	`outb
(0xA1, 0x0);

69 
	}
}

81 
	$œq_hªdËr
(
»gi¡”s_t
* 
r
)

85 
isq_t
 
hªdËr
 = 0;

88 
hªdËr
 = 
œq_routšes
[
r
->
št_no
];

89 ià(
hªdËr
)

91 
	`hªdËr
(
r
);

97 ià(
r
->
št_no
 >= 40)

99 
	`outb
(0xA0, 0x20);

104 
	`outb
(0x20, 0x20);

105 
	}
}

	@kernel/kb.c

9 
	~<kb.h
>

10 
	~<sy¡em.h
>

13 
	$keybßrd_hªdËr
(
»gi¡”s_t
* 
»gs
)

15 
sÿncode
;

18 
sÿncode
 = 
	`šb
(0x60);

22 ià(
sÿncode
 & 0x80)

41 
	`putch
(
kbdus
[
sÿncode
]);

43 
	}
}

45 
	$kb_š™
()

47 
	`œq_š¡®l_hªdËr
(33, &
keybßrd_hªdËr
);

48 
	}
}

	@kernel/main.c

9 
	~<asm.h
>

10 
	~<sü“n.h
>

12 
	$kmaš
()

14 
	`š™_video
();

15 
	`puts
("booting Panda OS ...\n");

16 
	`puts
("gdt_init ...\n");

17 
	`gdt_š™
();

18 
	`puts
("idt_init ...\n");

19 
	`idt_š™
();

20 
	`puts
("timer init ...\n");

21 
asm
 volatile ("int $0x3");

22 
asm
 volatile ("int $0x4");

23 
asm
 volatile("sti");

24 
	`tim”_š™
(1);

25 
	`puts
("kb init...\n");

26 
	`kb_š™
();

28 
š™Ÿl
 = 1;

31 if(
š™Ÿl
) {

32 
	`puts
("running\n");

33 
š™Ÿl
 = 0;

36 
	`§ã_h®t
();

37 
	}
}

	@kernel/screen.c

13 
	~<sy¡em.h
>

17 *
	g‹xtmem±r
;

18 
	g©Œib
 = 0x0F;

19 
	gc¤_x
 = 10, 
	gc¤_y
 = 0;

22 *
	$memıy
(*
de¡
, cÚ¡ *
¤c
, 
size_t
 
út
)

24 cÚ¡ *
¥
 = (cÚ¡ *)
¤c
;

25 *
dp
 = (*)
de¡
;

26 
út
--){

27 *
dp
++ = *
¥
++;

29  
de¡
;

30 
	}
}

33 * 
	$mem£t
(* 
addr
, 
v
, 
size_t
 
út
)

35 * 
t
 = (*)
addr
;

36 
út
--){

37 *
t
++ = 
v
;

39  
addr
;

40 
	}
}

42 * 
	$memmove
(* 
de¡
, cÚ¡ * 
¤c
, 
size_t
 
út
)

44 * 
»t
 = 
de¡
;

45 * 
d
 = (*)
de¡
;

46 cÚ¡ * 
s
 = 
¤c
;

47 ifĞ
d
<=
s
 || d>=(s+
út
)) {

48 
út
--){

49 *
d
++ = *
s
++;

53 
d
 +ğ(
út
+1);

54 
s
 +ğ(
út
+1);

55 
út
--){

56 *
d
-- = *
s
--;

59  
»t
;

60 
	}
}

62 *
	$mem£tw
(*
de¡
, 
v®
, 
size_t
 
couÁ
)

64 *
‹mp
 = (*)
de¡
;

65  ; 
couÁ
 !ğ0; couÁ--è*
‹mp
++ = 
v®
;

66  
de¡
;

67 
	}
}

69 
size_t
 
	$¡¾’
(cÚ¡ *
¡r
)

71 
size_t
 
»tv®
;

72 
»tv®
 = 0; *
¡r
 != '\0'; str++)

73 
»tv®
++;

74  
»tv®
;

75 
	}
}

77 
	$špÜtb
 (
_pÜt
)

79 
rv
;

80 
__asm__
 
	`__vŞ©e__
 ("šb %1, %0" : "÷" (
rv
è: "dN" (
_pÜt
));

81  
rv
;

82 
	}
}

84 
	$ouÜtb
 (
_pÜt
, 
_d©a
)

86 
__asm__
 
	`__vŞ©e__
 ("outb %1, %0" : : "dN" (
_pÜt
), "a" (
_d©a
));

87 
	}
}

91 
	$süŞl
()

93 
bÏnk
, 
‹mp
;

97 
bÏnk
 = 0x20 | (
©Œib
 << 8);

100 if(
c¤_y
 >= 25)

104 
‹mp
 = 
c¤_y
 - 25 + 1;

105 
	`memıy
 (
‹xtmem±r
,extmem±¸+ 
‹mp
 * 80, (25 -emp) * 80 * 2);

109 
	`mem£tw
 (
‹xtmem±r
 + (25 - 
‹mp
è* 80, 
bÏnk
, 80);

110 
c¤_y
 = 25 - 1;

112 
	}
}

116 
	$move_c¤
()

118 
‹mp
;

123 
‹mp
 = 
c¤_y
 * 80 + 
c¤_x
;

132 
	`ouÜtb
(0x3D4, 14);

133 
	`ouÜtb
(0x3D5, 
‹mp
 >> 8);

134 
	`ouÜtb
(0x3D4, 15);

135 
	`ouÜtb
(0x3D5, 
‹mp
);

136 
	}
}

139 
	$şs
()

141 
bÏnk
;

142 
i
;

146 
bÏnk
 = 0x20 | (
©Œib
 << 8);

150 
i
 = 0; i < 25; i++)

151 
	`mem£tw
 (
‹xtmem±r
 + 
i
 * 80, 
bÏnk
, 80);

155 
c¤_x
 = 0;

156 
c¤_y
 = 0;

157 
	`move_c¤
();

158 
	}
}

161 
	$putch
(
c
)

163 *
wh”e
;

164 
©t
 = 
©Œib
 << 8;

167 if(
c
 == 0x08)

169 if(
c¤_x
 != 0) csr_x--;

173 if(
c
 == 0x09)

175 
c¤_x
 = (csr_x + 8) & ~(8 - 1);

179 if(
c
 == '\r')

181 
c¤_x
 = 0;

186 if(
c
 == '\n')

188 
c¤_x
 = 0;

189 
c¤_y
++;

195 if(
c
 >= ' ')

197 
wh”e
 = 
‹xtmem±r
 + (
c¤_y
 * 80 + 
c¤_x
);

198 *
wh”e
 = 
c
 | 
©t
;

199 
c¤_x
++;

204 if(
c¤_x
 >= 80)

206 
c¤_x
 = 0;

207 
c¤_y
++;

211 
	`süŞl
();

212 
	`move_c¤
();

213 
	}
}

216 
šlše
 
	$puts
(cÚ¡ * 
‹xt
)

218 
i
;

220 
i
 = 0; i < 
	`¡¾’
(
‹xt
); i++)

222 
	`putch
(
‹xt
[
i
]);

224 
	}
}

226 
šlše
 
	$´štk
(cÚ¡ * 
‹xt
)

228 
	`puts
(
‹xt
);

229 
	}
}

231 
šlše
 
	$´štk_hex
(
u32
 
v®
)

233 
š™Ÿl
 = 1;

234 
k
;

235 
u32
 
t
;

236 
	`puts
("0x");

237 
k
=28; k>0; k-=4){

238 
t
 = (
v®
>>
k
) & 0xF;

239 ifĞ
t
==0 && 
š™Ÿl
 )

241 
š™Ÿl
 = 0;

242 ifĞ
t
 >ğ0xA ) 
	`putch
(-0xA+'A');

243 
	`putch
Ğ
t
+'0');

245 
t
 = 
v®
 & 0xF;

246 ifĞ
t
 >ğ0xA ) 
	`putch
(-0xA+'A');

247 
	`putch
Ğ
t
+'0');

248 
	}
}

250 
šlše
 
	$´štk_št
(
u32
 
v®
)

252 
buf
[12];

253 
út
 = 0;

254 
v®
>0) {

255 
buf
[
út
++] = '0' + 
v®
%10;

256 
v®
 /= 10;

258 if(
út
 == 0)

259 
	`putch
('0');

261 
út
){

262 
	`putch
(
buf
[--
út
]);

267 if(
v®
 <= 9 && val >= 0){

268 
	`putch
('0' + 
v®
);

271 
t
 = 1;

272 
t
<
v®
)

273 
t
 = * 10;

274 
t
 /= 10;

275 
t
) {

276 ifĞ
v®
 <= 9 && val >= 0){

277 
	`putch
('0' + 
v®
);

280 
	`putch
Ğ
v®
/
t
 + '0');

281 
v®
 = v® % 
t
;

282 
t
 /= 10;

286 
	}
}

289 
	$£‰extcŞÜ
(
fÜecŞÜ
, 
backcŞÜ
)

293 
©Œib
 = (
backcŞÜ
 << 4è| (
fÜecŞÜ
 & 0x0F);

294 
	}
}

297 
	$š™_video
()

299 
‹xtmem±r
 = (*)0xB8000;

300 
	`şs
();

301 
	}
}

	@kernel/timer.c

9 
	~<sy¡em.h
>

10 
	~<sü“n.h
>

11 
	~<asm.h
>

16 
	gtim”_ticks
 = 0;

23 
	$tim”_hªdËr
(
»gi¡”s_t
* 
»gs
)

26 
tim”_ticks
++;

30 ià(
tim”_ticks
 % 18 == 0)

32 
	`puts
("One second has…assed\n");

34 
	}
}

38 
	$tim”_wa™
(
ticks
)

40 
‘icks
;

42 
‘icks
 = 
tim”_ticks
 + 
ticks
;

43 
tim”_ticks
 < 
‘icks
);

44 
	}
}

48 
	$tim”_š¡®l
()

51 
	`œq_š¡®l_hªdËr
(0, 
tim”_hªdËr
);

52 
	}
}

56 
u32
 
	gticks
 = 0;

57 
u32
 
	g£cÚds
 = 0;

58 
	$tim”_ÿÎback
(
»gi¡”s_t
* 
»gs
)

60 
ticks
++;

63 ià(
ticks
 % 70 == 0)

68 
£cÚds
++;

71 
	}
}

73 
	$tim”_š™
(
u32
 
äequ’cy
)

76 
	`œq_š¡®l_hªdËr
(32, &
tim”_ÿÎback
);

82 
u32
 
divisÜ
 = 1193180 ;

85 
	`outb
(0x43, 0x36);

88 
u8
 
l
 = (u8)(
divisÜ
 & 0xFF);

89 
u8
 
h
 = (u8)((
divisÜ
>>8) & 0xFF );

92 
	`outb
(0x40, 
l
);

93 
	`outb
(0x40, 
h
);

94 
	}
}

99 
	$tim”_wa™
(
wa™
)

101 
‘icks
;

103 
‘icks
 = 
ticks
 + 
wa™
;

104 
ticks
 < 
‘icks
);

105 
	}
}

	@system.h

9 #ià!
defšed
(
SYSTEM_H
)

10 
	#SYSTEM_H


	)

13 
	tsize_t
;

14 
	tu64
;

15 sigÃd 
	ts64
;

16 
	tu32
;

17 sigÃd 
	ts32
;

18 
	tu16
;

19 sigÃd 
	ts16
;

20 
	tu8
;

21 sigÃd 
	ts8
;

25 
	s»gi¡”s_t


27 
	mgs
, 
	mfs
, 
	mes
, 
	mds
;

28 
	medi
, 
	mesi
, 
	mebp
, 
	me¥
, 
	mebx
, 
	medx
, 
	mecx
, 
	m—x
;

29 
	mšt_no
, 
	m”r_code
;

30 
	me
, 
	mcs
, 
	meæags
, 
	mu£»¥
, 
	mss
;

33 (*
	tisq_t
è(
	t»gi¡”s_t
* 
	tr
);

35 
	`œq_š¡®l_hªdËr
(
œq
, 
isq_t
 
hªdËr
);

36 
	`idt_£t
(
k
, 
ba£
,

37 
£ËùÜ
, 
æags
);

39 
	`tim”_š™
(
u32
 
äequ’cy
);

40 
	`tim”_wa™
(
ticks
);

	@
1
.
1
/usr/include
13
179
include/asm.h
include/kb.h
include/screen.h
include/system.h
kernel/asm.c
kernel/gdt.c
kernel/idt.c
kernel/irq.c
kernel/kb.c
kernel/main.c
kernel/screen.c
kernel/timer.c
system.h
